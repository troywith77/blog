<!DOCTYPE html>
<html style="height: 100%">
<head>
  <meta charset="utf-8">
  
  <title>Open Weather App using React | Troy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="这是一个利用 Open Weather 的 API 使用 React 写的一个天气查询App。Github Repo 虽然挺简单的，但是做教程写的话，感觉也得分好几篇了。。（好像还没到可以写教程的水平(•̀ロ•́)و✧ ~~ 就尽量记录清楚一点吧~） PS: 写这个React app的时候一会用ES5，一会用ES6也是醉了 | ｀Д´|">
<meta property="og:type" content="article">
<meta property="og:title" content="Open Weather App using React">
<meta property="og:url" content="http://www.tangrui.win/blog/2016/03/09/Open-Weather-App-using-React/index.html">
<meta property="og:site_name" content="Troy&#39;s Blog">
<meta property="og:description" content="这是一个利用 Open Weather 的 API 使用 React 写的一个天气查询App。Github Repo 虽然挺简单的，但是做教程写的话，感觉也得分好几篇了。。（好像还没到可以写教程的水平(•̀ロ•́)و✧ ~~ 就尽量记录清楚一点吧~） PS: 写这个React app的时候一会用ES5，一会用ES6也是醉了 | ｀Д´|">
<meta property="og:locale" content="ZH-CN">
<meta property="og:image" content="http://www.tangrui.win/blog/images/Open-Weather-App-using-Reac/home.png">
<meta property="og:image" content="http://www.tangrui.win/blog/images/Open-Weather-App-using-Reac/forecast.png">
<meta property="og:image" content="http://www.tangrui.win/blog/images/Open-Weather-App-using-Reac/detail.png">
<meta property="og:image" content="http://www.tangrui.win/blog/images/Open-Weather-App-using-Reac/end.png">
<meta property="og:updated_time" content="2018-03-15T03:46:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Open Weather App using React">
<meta name="twitter:description" content="这是一个利用 Open Weather 的 API 使用 React 写的一个天气查询App。Github Repo 虽然挺简单的，但是做教程写的话，感觉也得分好几篇了。。（好像还没到可以写教程的水平(•̀ロ•́)و✧ ~~ 就尽量记录清楚一点吧~） PS: 写这个React app的时候一会用ES5，一会用ES6也是醉了 | ｀Д´|">
<meta name="twitter:image" content="http://www.tangrui.win/blog/images/Open-Weather-App-using-Reac/home.png">
  
    <link rel="alternative" href="/atom.xml" title="Troy&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/favicon.ico">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

</head>
<body style="height: 100%">
  <div id="bg">
    <div id="bg-mask">
      <h1>Troy's Blog</h1>
      <p>思想，故事和灵感</p>
    </div>
  </div>
  <nav class="nav">
    <ul>
      <li><a href="/blog">Home</a></li><li><a href="/blog/archives">Archives</a></li><li><a href="http://www.github.com/troywith77">Github</a></li><li><a href="http://tangrui.win">About</a></li><li><a href="mailto:ruitang307@gmail.com">Mail me</a></li>
    </ul>
  </nav>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/blog/">Troy&#39;s Blog</a>
	</h1>
	<p class="cite-myself">思想，故事和灵感</p>
</header>
    <div id="main">
      <article id="post-Open-Weather-App-using-React" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/blog/2016/03/09/Open-Weather-App-using-React/" class="article-date">
  <time datetime="2016-03-09T10:04:46.000Z" itemprop="datePublished">03-09-2016</time>
</a>
		</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Open Weather App using React
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>这是一个利用 Open Weather 的 <a href="http://openweathermap.org/api" target="_blank" rel="noopener">API</a> 使用 React 写的一个天气查询App。<a href="https://github.com/troywith77/react-weather" target="_blank" rel="noopener">Github Repo</a></p>
<p>虽然挺简单的，但是做教程写的话，感觉也得分好几篇了。。（好像还没到可以写教程的水平(•̀ロ•́)و✧ ~~ 就尽量记录清楚一点吧~）</p>
<p>PS: 写这个React app的时候一会用ES5，一会用ES6也是醉了 | ｀Д´|</p>
<a id="more"></a>
<h3 id="Step0-配置npm、webpack以及babel"><a href="#Step0-配置npm、webpack以及babel" class="headerlink" title="Step0 配置npm、webpack以及babel"></a>Step0 配置npm、webpack以及babel</h3><p><code>package.json</code>里面的部分关键配置，包括启动脚本以及依赖<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"webpack-dev-server --inline --content-base dist/ --history-api-fallback"</span>,</span><br><span class="line">    <span class="comment">//使用webpack-dev-server时的命令</span></span><br><span class="line">    <span class="string">"start:prod"</span>: <span class="string">"webpack -p &amp;&amp; node server.js"</span></span><br><span class="line">    <span class="comment">//生产环境的命令</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"axios"</span>: <span class="string">"^0.9.1"</span>,   <span class="comment">// making http request</span></span><br><span class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-react"</span>: <span class="string">"^6.5.0"</span>,</span><br><span class="line">    <span class="string">"react"</span>: <span class="string">"^0.14.7"</span>,</span><br><span class="line">    <span class="string">"react-dom"</span>: <span class="string">"^0.14.7"</span>,</span><br><span class="line">    <span class="string">"react-router"</span>: <span class="string">"^2.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.5.2"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^6.2.4"</span>,</span><br><span class="line">    <span class="string">"babel-preset-react"</span>: <span class="string">"^6.5.0"</span>,</span><br><span class="line">    <span class="string">"html-webpack-plugin"</span>: <span class="string">"^2.9.0"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^1.12.14"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^1.14.1"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>这里是<code>webpack.config.js</code>的配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var HtmlWebpackPlugin = require('html-webpack-plugin')</span></span><br><span class="line"><span class="comment">var HTMLWebpackPluginConfig = new HtmlWebpackPlugin(&#123;</span></span><br><span class="line"><span class="comment">  template: __dirname + '/app/index.html',  //模板文件</span></span><br><span class="line"><span class="comment">  filename: 'index.html',  //文件名</span></span><br><span class="line"><span class="comment">  inject: 'body'  //script标签插入到body标签里</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    之前用了html-webpack-plugin这个插件自动生成dist里面的index.html，</span></span><br><span class="line"><span class="comment">    但是由于使用browserHistory需要引用script标签时用绝对引用，这个插件引入</span></span><br><span class="line"><span class="comment">    的不是绝对引用，所以暂时这里自己在dist目录下新建一个index.html，</span></span><br><span class="line"><span class="comment">    引入inde_bundle.js文件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: [</span><br><span class="line">    <span class="string">'./app/index.js'</span>   <span class="comment">//设置入口文件，webpack将从这里开始打包依赖的代码</span></span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: __dirname + <span class="string">'/dist'</span>,  <span class="comment">//顾名思义，输出文件的目录</span></span><br><span class="line">    filename: <span class="string">"index_bundle.js"</span>  <span class="comment">//输出的文件名</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [  <span class="comment">//对文件进行操作用到的（工具？）不知道怎么描述(￣ε(#￣) Σ</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,  <span class="comment">//正则匹配以js结尾的文件</span></span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">//不匹配这个文件夹里文件</span></span><br><span class="line">        loader: <span class="string">"babel-loader"</span>,  <span class="comment">//使用这个loader</span></span><br><span class="line">        query: &#123;</span><br><span class="line">          presets: [<span class="string">'react'</span>, <span class="string">'es2015'</span>]  <span class="comment">//对这个loader的配置，先用es2015转换一下再用react的语法转换</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [HTMLWebpackPluginConfig]  <span class="comment">//使用这个插件可以自动生成带有script标签的html文件，配置在顶上</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Step1-配置最基本的React-Router"><a href="#Step1-配置最基本的React-Router" class="headerlink" title="Step1 配置最基本的React Router"></a>Step1 配置最基本的React Router</h3><p>在根目录创建一个app目录，里面存放我们开发时用的文件，转到生产环境后会build文件到dist目录，这个之后再讲。</p>
<blockquote>
<p>注意：webpack-dev-server中有一个命令是<code>--content-base dist/</code>，意思是启动服务器时会把dist目录作为根目录，开发时用到的公共文件将放在这里。</p>
</blockquote>
<p>app/目录结构：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app/</span><br><span class="line">    components/</span><br><span class="line">    config/</span><br><span class="line">    containers/</span><br><span class="line">    helpers/</span><br><span class="line">    index.html</span><br><span class="line">    index.js</span><br><span class="line">dist/</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure></p>
<p><strong> index.html </strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>因为上面webpack里配置了`html-webpack-plugin``插件，所以启动服务器后会制动生成一个带有bundle后的js文件的html文件。</p>
<p><strong> index.js </strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(routes, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure></p>
<p>把用<code>react-router</code>组织的组件render到<code>#app</code>上。</p>
<p>在config文件夹里面新建一个<code>routes.js</code>文件</p>
<!--more-->
<blockquote>
<p>之后一些Component的引入就省略掉了，看到要用Component的地方应该知道肯定要先引入才行的吧~ 必要的引入会提出来</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Router, Route, browserHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> routes = (</span><br><span class="line">  &lt;Router history=&#123;browserHistory&#125;&gt;  <span class="comment">//为了得到干净的url</span></span><br><span class="line">    &lt;Route path=<span class="string">'/'</span> component=&#123;Main&#125;&gt;</span><br><span class="line">      <span class="comment">//设置一个url为'/'时的路由</span></span><br><span class="line">      <span class="comment">//渲染其子路由时，Main组件会一直存在，SPA嘛~</span></span><br><span class="line">      &lt;IndexRoute component=&#123;HomeContainer&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">IndexRoute</span>&gt;</span></span></span><br><span class="line">      <span class="comment">//路由为'/'时渲染HomeComponent组件</span></span><br><span class="line">    &lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Router&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = routes;</span><br></pre></td></tr></table></figure>
<p>在containers文件夹里新建一个Main.js文件：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="type">Link</span> &#125; from <span class="symbol">'react</span>-router'</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">      <span class="comment">//每个React Component都必须有且只有一个根元素！！很容易出错的地方</span></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h1&gt;</span><br><span class="line">            &lt;<span class="type">Link</span> to='/' style=&#123;styles.link&#125;&gt;<span class="type">Clever</span> <span class="type">Weather</span>&lt;/<span class="type">Link</span>&gt;</span><br><span class="line">            <span class="comment">//Link组件是react-router里定义的</span></span><br><span class="line">            <span class="comment">//to属性是定义的路由path，链接要用这个组件，用普通的a标签不可以</span></span><br><span class="line">          &lt;/h1&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">        <span class="comment">//这是子路由起作用的关键，Main组件之外的子组件将渲染到这里。</span></span><br><span class="line">        <span class="comment">//作用应该和Angular里的ui-view差不多吧~</span></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后新建一个HomeContainer.js文件：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeContainer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;h1&gt;<span class="type">Hello</span> <span class="type">World</span>!&lt;/h1&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到这里在终端里输入<code>npm start</code>启动我们的webpack-dev-server就可以看到<code>Hello World！</code>了~</p>
<p><strong> open <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> </strong></p>
<h3 id="Step2-添加查询输入框和按钮"><a href="#Step2-添加查询输入框和按钮" class="headerlink" title="Step2 添加查询输入框和按钮"></a>Step2 添加查询输入框和按钮</h3><blockquote>
<p>以下引入的CSS都不会写出来，反正很简单~(๑╹∀╹๑)萌</p>
</blockquote>
<p>新建一个<strong> GetCityContainer.js </strong> 文件<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> GetCityContainer = React.createClass(&#123;</span><br><span class="line">  contextTypes: &#123;</span><br><span class="line">    router: React.PropTypes.<span class="keyword">object</span>.isRequired  <span class="comment">//用来跳转路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getDefaultProps() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      direction: <span class="string">'column'</span>  <span class="comment">//设置默认的direction prop为"column"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getInitialState() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      city: <span class="string">''</span>  <span class="comment">//设置state</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  handleSubmitCity() &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  handleUpdateCity(e) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;city: e.target.value&#125;)</span><br><span class="line">    <span class="comment">//子组件里的Input 触发onChange事件时最终会触发这个事件</span></span><br><span class="line">    <span class="comment">//子组件向夫组件通信通过props来完成</span></span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;GetCity</span><br><span class="line">      onSubmitCity=&#123;<span class="keyword">this</span>.handleSubmitCity&#125;</span><br><span class="line">      onUpdateCity=&#123;<span class="keyword">this</span>.handleUpdateCity&#125;</span><br><span class="line">      city=&#123;<span class="keyword">this</span>.state.city&#125;  <span class="comment">//像子组件传递一个prop</span></span><br><span class="line">      direction=&#123;<span class="keyword">this</span>.props.direction&#125;  <span class="comment">//传递prop</span></span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<!--more-->
<p>在components文件夹里新建一个<strong> GetCity </strong>文件<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Input</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);  <span class="comment">//必要</span></span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input</span><br><span class="line">      className=<span class="symbol">'form</span>-control'</span><br><span class="line">      placeholder=<span class="symbol">'St</span>. <span class="type">George</span>, <span class="type">Utah</span>'</span><br><span class="line">      <span class="class"><span class="keyword">type</span></span>=<span class="symbol">'tex</span>t'</span><br><span class="line">      value=&#123;<span class="keyword">this</span>.props.city&#125;</span><br><span class="line">      onChange=&#123;<span class="keyword">this</span>.props.onUpdateCity&#125;  <span class="comment">//通过props向父组件通信</span></span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">      <span class="class"><span class="keyword">type</span></span>=<span class="symbol">'butto</span>n'</span><br><span class="line">      style=&#123;&#123;margin: <span class="number">10</span>&#125;&#125;</span><br><span class="line">      className=<span class="symbol">'btn</span> btn-success'</span><br><span class="line">      onClick=&#123;<span class="keyword">this</span>.props.onSubmitCity&#125;  <span class="comment">//点击按钮时触发父组件的事件</span></span><br><span class="line">      &gt;</span><br><span class="line">      &#123;<span class="keyword">this</span>.props.children&#125;  <span class="comment">//使用该组件式里面的内容会渲染到这</span></span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getStyles(props) &#123;</span><br><span class="line">  <span class="comment">//根据传入的props返回不同的css</span></span><br><span class="line">  <span class="comment">//在这里是改变flex-direction，因为会有不同使用情况</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    display: <span class="symbol">'fle</span>x',</span><br><span class="line">    flexDirection: props.direction || <span class="symbol">'colum</span>n',</span><br><span class="line">    justifyContent: <span class="symbol">'cente</span>r',</span><br><span class="line">    alignItems: <span class="symbol">'cente</span>r',</span><br><span class="line">    maxWidth: <span class="number">300</span>,</span><br><span class="line">    alignSelf: <span class="symbol">'righ</span>t'</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetCity</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div style=&#123;getStyles(<span class="keyword">this</span>.props)&#125;&gt;  <span class="comment">//这里应用了上面返回的css对象</span></span><br><span class="line">        &lt;<span class="type">Input</span></span><br><span class="line">        city=&#123;<span class="keyword">this</span>.props.city&#125;</span><br><span class="line">        onUpdateCity=&#123;<span class="keyword">this</span>.props.onUpdateCity&#125;</span><br><span class="line">        <span class="comment">//接收来自Input组件的事件继续向父组件传递</span></span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;<span class="type">Button</span></span><br><span class="line">        onSubmitCity=&#123;<span class="keyword">this</span>.props.onSubmitCity&#125;&gt;</span><br><span class="line">        <span class="type">Get</span> <span class="type">Weather</span></span><br><span class="line">        &lt;/<span class="type">Button</span>&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Home组件里引入GetCityContainer组件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Enter a City Name&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;GetCityContainer /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>在Main组件里引入GetCityContainer组件并且传入一个prop为 <code>direction=&#39;row&#39;</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">GetCityContainer</span> <span class="attr">direction</span>=<span class="string">'row'</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>现在首页的UI就完成了，但是还没有任何功能(⊙o⊙)哦！现在页面应该长这样~ (点击看大图~)</p>
<p><img src="/blog/images/Open-Weather-App-using-Reac/home.png" alt="post"></p>
<h3 id="Step3-添加新的天气预报页面的路由"><a href="#Step3-添加新的天气预报页面的路由" class="headerlink" title="Step3 添加新的天气预报页面的路由"></a>Step3 添加新的天气预报页面的路由</h3><p>首先在routes.js里添加一个新的路由<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;browserHistory&#125;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">'/'</span> <span class="attr">component</span>=<span class="string">&#123;Main&#125;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;HomeContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">IndexRoute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">'forecast/:city'</span> <span class="attr">component</span>=<span class="string">&#123;ForecastContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">      //这个path的意思是可以进入比如'/forecast/shanghai'这样的url里</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 <strong> GetCityContainer </strong>里更新一下方法<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleSubmitCity</span><span class="params">()</span></span> &#123;</span><br><span class="line">    this<span class="selector-class">.context</span><span class="selector-class">.router</span><span class="selector-class">.push</span>(<span class="string">'/forecast/'</span> + this<span class="selector-class">.state</span><span class="selector-class">.city</span>)</span><br><span class="line">    <span class="comment">//点击按钮时会使用context的push方法跳转到其他路由</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后把open weather的api写到<strong> helpers/api.js </strong> 中，具体可查看<a href="https://github.com/troywith77/react-weather/blob/master/app/helpers/api.js" target="_blank" rel="noopener">源代码</a></p>
<p>新建一个<strong> ForecasrContainer.js </strong></p>
<!--more-->
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;getCurrentWeather, getForcast&#125; from <span class="string">'../helpers/api'</span></span><br><span class="line"><span class="comment">//引入API</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ForecastContainer = React.createClass(&#123;</span><br><span class="line">  contextTypes: &#123;</span><br><span class="line">    router: React.PropTypes.<span class="keyword">object</span>.isRequired  <span class="comment">//使用context进行路由跳转</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getInitialState: () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      isLoading: <span class="literal">true</span>,  <span class="comment">//设置一个loading状态，初始为true</span></span><br><span class="line">      forecastData: &#123;&#125;  <span class="comment">//设置一个state存放预报数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.makeRequest(<span class="keyword">this</span>.props.params.city)</span><br><span class="line">    <span class="comment">//组件加载完成后执行函数，将路由中的city参数传入进去</span></span><br><span class="line">  &#125;,</span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="keyword">this</span>.makeRequest(nextProps.params.city)</span><br><span class="line">    <span class="comment">//当组件即将要接收到新的props参数前发生的事件</span></span><br><span class="line">    <span class="comment">//在这里是当点击Header中的按钮时会重新发送一次请求，获取新的城市的数据</span></span><br><span class="line">  &#125;,</span><br><span class="line">  makeRequest(city) &#123;  <span class="comment">//Promise从API获取五日天气预报数据</span></span><br><span class="line">    getForcast(city)</span><br><span class="line">      .then(function (forecastData) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          isLoading: <span class="literal">false</span>,  <span class="comment">//获取数据之后设置loading状态为false</span></span><br><span class="line">          forecastData: forecastData  <span class="comment">//将返回的数据传给这个state</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.bind(<span class="keyword">this</span>));  <span class="comment">//记得要bind一下，把函数内this的指向改成本组件</span></span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Forecast</span><br><span class="line">        city=&#123;<span class="keyword">this</span>.props.params.city&#125;</span><br><span class="line">        isLoading=&#123;<span class="keyword">this</span>.state.isLoading&#125;</span><br><span class="line">        forecastData=&#123;<span class="keyword">this</span>.state.forecastData&#125; /&gt;  <span class="comment">//向子组件传入数据</span></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ForecastContainer.contextTypes = &#123;</span><br><span class="line">  router: React.PropTypes.<span class="keyword">object</span>.isRequired  <span class="comment">//类型绑定</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = ForecastContainer</span><br></pre></td></tr></table></figure>
<p>在components文件夹里新建一个<strong>Forecast</strong>组件<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DayItem from <span class="string">'./DayItem'</span></span><br><span class="line"><span class="comment">/* 更小的一个组件，显示具体天气的图标，以及一些简要信息，</span></span><br><span class="line"><span class="comment">   因为会在多处用到，所以提取成一个组件，React也提倡具体的细分组件 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 下面这种写法好像叫stateless 什么什么，意思是这种组件没有state，</span></span><br><span class="line"><span class="comment">   给它传入什么数据它就只会单纯的显示什么出来，不会向上对父组件</span></span><br><span class="line"><span class="comment">   发送任何数据，用定义函数的方法来定义 */</span></span><br><span class="line"></span><br><span class="line">function ForecastUI (props) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;&#123;props.city&#125;&lt;/h1&gt;  <span class="comment">//</span></span><br><span class="line">      &lt;div&gt;</span><br><span class="line">      <span class="comment">//这里的props.data.list是接下来五天天气预报数据的一个数组，</span></span><br><span class="line">      <span class="comment">//使用map方法然后返回组件（或者是HTML）可以将这个数组里的数据呈现出来</span></span><br><span class="line">        &#123;props.<span class="keyword">data</span>.list.map(function(item) &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;DayItem</span><br><span class="line">            key=&#123;item.id&#125;</span><br><span class="line">            <span class="comment">//每个数组map时或者使用iterator时，都要添加一个key属性</span></span><br><span class="line">            <span class="comment">//但是我这里是照官网的教程说的，添加到Component上而不是HTML，</span></span><br><span class="line">            <span class="comment">//但是这里仍然会报警告，don't know why(｡•ˇ‸ˇ•｡)</span></span><br><span class="line">            day=&#123;item&#125; /&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Forecast</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.props.isLoading) &#123;</span><br><span class="line">    <span class="comment">//由传入的isLoading判断显示哪一个组件</span></span><br><span class="line">      <span class="keyword">return</span> (&lt;h1&gt; Loading &lt;/h1&gt;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;ForecastUI</span><br><span class="line">        city=&#123;<span class="keyword">this</span>.props.city&#125;  <span class="comment">//继续向下传递数据</span></span><br><span class="line">        <span class="keyword">data</span>=&#123;<span class="keyword">this</span>.props.forecastData&#125;</span><br><span class="line">        handleClick=&#123;<span class="keyword">this</span>.props.handleClick&#125; /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>新建<strong> DayItem </strong>组件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;convertTemp, convertDate&#125; <span class="keyword">from</span> <span class="string">'../helpers/utils'</span></span><br><span class="line"><span class="comment">//API返回的温度是绝对温度，需要转换</span></span><br><span class="line"><span class="comment">//返回的时间是UnixTimesMpa， 需要转换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//数据具体怎么渲染要看API借口噢~</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DayItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = convertDate(props.day.dt);  <span class="comment">//转换后格式化的时间</span></span><br><span class="line">  <span class="keyword">var</span> icon = props.day.weather[<span class="number">0</span>].icon;</span><br><span class="line">  <span class="comment">//不同的天气有不同的代码，通过这个代码引入不同的文件</span></span><br><span class="line">  <span class="comment">//文件名和icon代码一样，方便引入</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div onClick=&#123;props.handleClick&#125;&gt;</span><br><span class="line">      &lt;img src=&#123;<span class="string">'/blog/images/weather-icons/'</span> + icon + <span class="string">'.svg'</span>&#125; /&gt;</span><br><span class="line">      &lt;h2&gt;&#123;date&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = DayItem;</span><br></pre></td></tr></table></figure></p>
<p>现在App的预报界面应该是这样的（这里没有写CSS的操作哦）</p>
<p><img src="/blog/images/Open-Weather-App-using-Reac/forecast.png" alt="post"></p>
<p>到现在我们已经完成了一个具有简单查询功能的天气APP啦，接下来就再添加一个详情页面，使上面的每一天的预报都可以点击然后进入详情页面的路由~</p>
<h3 id="Step4-添加详情路由，跳转到该路由时传入数据"><a href="#Step4-添加详情路由，跳转到该路由时传入数据" class="headerlink" title="Step4 添加详情路由，跳转到该路由时传入数据"></a>Step4 添加详情路由，跳转到该路由时传入数据</h3><p>首先打开<strong> routes.js </strong>，在主路由下添加一行<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">'detail/:city'</span> <span class="attr">component</span>=<span class="string">&#123;DetailContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后新建一个<strong> DetailContainer.js </strong> 和 <strong> Detail.js </strong>文件<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DetailContainer.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailContainer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;<span class="type">Detail</span></span><br><span class="line">      city=&#123;<span class="keyword">this</span>.props.routeParams.city&#125; /&gt;  <span class="comment">//获取路由上的city参数</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<!--more-->
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Detail.js</span></span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Detaul</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">           <span class="comment">//暂时没有东西，因为还没有把数据从上一个预报页面传过来</span></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打开<strong> DayItem.js </strong><br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在根元素上添加<span class="keyword">onClick</span>=&#123;props.handleClick&#125;</span><br><span class="line"><span class="comment">//注意这里用的是stateless functional component，所以不是this.props</span></span><br></pre></td></tr></table></figure></p>
<p>然后打开<strong> Forecast.js </strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在ForecastUI里map函数返回DayItem组件时，在DayItem组件上添加一个</span><br><span class="line">handleClick=&#123;props<span class="selector-class">.handleClick</span><span class="selector-class">.bind</span>(null, item)&#125;</span><br><span class="line"><span class="comment">//这里把item，也就是每一天的天气预报数据传到父组件里</span></span><br><span class="line"></span><br><span class="line">在Forecast组件中同样添加handleClick=&#123;this<span class="selector-class">.props</span><span class="selector-class">.handleClick</span>&#125;，继续传递事件与数据。</span><br></pre></td></tr></table></figure></p>
<p>再打开<strong> ForecastContainer.js </strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在return的Forecast组件上添加一个属性，handleClick = &#123;this.handleClick&#125;</span></span><br><span class="line"><span class="comment">//用来处理下面穿上来的数据的函数就是这个ForecastContainer组件的handleClick函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加handleClick事件</span></span><br><span class="line"><span class="function"><span class="title">handleClick</span><span class="params">(weather)</span></span> &#123;  <span class="comment">//这里的weather就是之前传上来的item</span></span><br><span class="line">    this<span class="selector-class">.context</span><span class="selector-class">.router</span><span class="selector-class">.push</span>(&#123;</span><br><span class="line">    <span class="comment">//之前我们用过context来改变路由，是直接传入string的</span></span><br><span class="line">    <span class="comment">//这里是传入一个对象，state属性可以传递数据</span></span><br><span class="line">        pathname: <span class="string">'/detail/'</span> + this<span class="selector-class">.props</span><span class="selector-class">.routeParams</span><span class="selector-class">.city</span>,  <span class="comment">//路由地址</span></span><br><span class="line">        state: &#123;</span><br><span class="line">            weather: weather</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样的话我们就可以把详细的每一天的数据传到详情路由页面的，下面看看我们要怎么在详情界面获取到这些数据并渲染到页面上~</p>
<p>打开<strong> DetailContainer.js </strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">return (</span><br><span class="line">      &lt;Detail</span><br><span class="line">      <span class="comment">//显而易见，就是这么简单</span></span><br><span class="line">      weather=&#123;this<span class="selector-class">.props</span><span class="selector-class">.location</span><span class="selector-class">.state</span><span class="selector-class">.weather</span>&#125;</span><br><span class="line"></span><br><span class="line">      city=&#123;this<span class="selector-class">.props</span><span class="selector-class">.routeParams</span><span class="selector-class">.city</span>&#125; /&gt;  <span class="comment">//获取路由上的city参数</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure></p>
<p>打开<strong> Detail.js </strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123;convertTemp&#125; from <span class="string">'../helpers/utils'</span>  <span class="comment">//转换绝对温度</span></span><br><span class="line"></span><br><span class="line">return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;DayItem day=&#123;this<span class="selector-class">.props</span><span class="selector-class">.weather</span>&#125; /&gt;</span><br><span class="line">        <span class="comment">//下面的数据全部都是从刚刚的state.weather中获取到的</span></span><br><span class="line">        <span class="comment">//具体的信息可以查看API解释</span></span><br><span class="line">        &lt;<span class="selector-tag">div</span> style=&#123;styles.container&#125;&gt;</span><br><span class="line">          &lt;p&gt;City: &#123;this<span class="selector-class">.props</span><span class="selector-class">.city</span>&#125;&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;&#123;this<span class="selector-class">.props</span><span class="selector-class">.weather</span><span class="selector-class">.weather</span>[<span class="number">0</span>].description&#125;&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;min Temp: &#123;convertTemp(this<span class="selector-class">.props</span><span class="selector-class">.weather</span><span class="selector-class">.temp</span><span class="selector-class">.min</span>)&#125;degree&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;max Temp: &#123;convertTemp(this<span class="selector-class">.props</span><span class="selector-class">.weather</span><span class="selector-class">.temp</span><span class="selector-class">.max</span>)&#125;degree&lt;/p&gt;</span><br><span class="line">          &lt;p&gt;humidity: &#123;this<span class="selector-class">.props</span><span class="selector-class">.weather</span><span class="selector-class">.humidity</span>&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></p>
<p>Finally，这个简单的App就基本完成了！！！( ﾟ▽ﾟ)/</p>
<p>这个详情页的样子是这样~</p>
<p><img src="/blog/images/Open-Weather-App-using-Reac/detail.png" alt="post"></p>
<h3 id="Step5-配置生产环境服务器"><a href="#Step5-配置生产环境服务器" class="headerlink" title="Step5 配置生产环境服务器"></a>Step5 配置生产环境服务器</h3><p><strong> 最终Demo位置，</strong> <a href="http://115.159.95.239:8080/" target="_blank" rel="noopener">看这里~</a></p>
<p>其实在step4的时候我们的app已经完成了，但是webpack-dev-server并不是一个production server，要把我们的app部署到真正的服务器上的话，我们需要一个production server，which is to say，配置一个Node服务器。</p>
<p>but，我只是简单的配置一下，毕竟我对node也不熟啊( ͡° ͜ʖ ͡°)</p>
<p><code>npm install --save express</code> 安装一下express</p>
<p>然后我们到根目录下创建一个<strong> server.js </strong>文件</p>
<!-- more -->
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>( <span class="string">'express'</span> );</span><br><span class="line"><span class="keyword">var</span> path = <span class="keyword">require</span>( <span class="string">'path'</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()  <span class="comment">//创建一个express实例</span></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(express.<span class="keyword">static</span>(path.join(__dirname, <span class="string">'dist'</span>)))</span><br><span class="line"><span class="comment">//使用dist目录作为静态文件根目录</span></span><br><span class="line"><span class="comment">//所以我们可以使用/blog/images/...的路径来获取我们的icon图标等等</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</span><br><span class="line">  res.sendFile(path.join(__dirname, <span class="string">'dist'</span>, <span class="string">'index.html'</span>))</span><br><span class="line">  <span class="comment">//这个是express的路由配置，但是我们是使用react router来配置路由的</span></span><br><span class="line">  <span class="comment">//所以我们这里就不管请求什么页面，都返回我们的index.html</span></span><br><span class="line">  <span class="comment">//然后让react router来跳转路由</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PORT = process.env.port || <span class="number">8080</span></span><br><span class="line"><span class="comment">//设置服务器端口，默认8080</span></span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  console.log(<span class="string">'App is running on port '</span> + PORT)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>设置完成之后添加一条<code>npm script</code>，然而我在step1的时候已经写进去了(<em>・_・)ノ⌒</em><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        <span class="attr">"start:prod"</span>: <span class="string">"webpack -p &amp;&amp; node server.js"</span></span><br><span class="line">        //先webpack打包压缩一下，然后启动node服务器</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Biu~ 一个简单的生产环境服务器就配置完成了。</p>
<p>在终端使用<code>npm run start:prod</code>命令就可以启动服务器了。</p>
<p>到这里，这个简单的教程应该就全部结束了，把这些东西写下来也是够累的。(●´∀｀●)</p>
<p><a href="https://github.com/troywith77/react-weather" target="_blank" rel="noopener">Github Repo</a></p>
<p><img src="/blog/images/Open-Weather-App-using-Reac/end.png" alt="post"></p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/blog/2018/01/24/2018/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          2018
        
      </div>
    </a>
  
  
    <a href="/blog/2016/03/07/angular-meteor-学习笔记/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Angular-Meteor 学习笔记
        
      </div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="post-Open-Weather-App-using-React" data-title="Open Weather App using React" data-url="http://www.tangrui.win/blog/2016/03/09/Open-Weather-App-using-React/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"troywith77"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0]
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
		</script>
	<!-- 多说公共JS代码 end -->
</section>

    </div>
    <footer id="footer">
	<div class="footer-blog-title">
		<p>&copy; 2018 Troy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
		<p>Glad to meet you here!<br /></p>
		<p>If you like the theme, go get it! <a href="https://github.com/troywith77/zenT">Install !</a></p>
	</div>
</footer>
    

<script src="/blog/js/jquery.min.js"></script>


<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>
  </div>
</body>
</html>